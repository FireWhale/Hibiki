//Used to calculate visibility of albums after a sort/toggle/filter
//Called from (but not limited to) toggle_albums and sort_albums

function calcvisibility( albumdiv ) {
  var flagdata = albumdiv.data('flags');
  var collect = albumdiv.data('collection');
  var le = albumdiv.data('le');
  var reprint = albumdiv.data('reprint');
  <% #Fade in anything that has a yes %>
    if(flagdata.indexOf('y') != -1) {
      if(filters.indexOf(collect) > -1 && filters.indexOf(le) > -1 && filters.indexOf(reprint) > -1) {
        albumdiv.fadeIn(1000);
        <% #We should also toggle the week text %>
        albumdiv.parent().fadeIn(1000)
        albumdiv.parent().children('.divider-header').fadeIn(1000)
      };  
    };
  <% #Fade out anything that doesn't have a yes %>
    if(flagdata.indexOf('y') == -1) {
      albumdiv.fadeOut(500,function(){
        if(albumdiv.parent().children('.album-well:visible').length == 0) {
          $(albumdiv.parent()).hide();
          $(albumdiv.parent().children('.divider-header')).hide();
        }
      });
    }

  $(window).scroll();
};